<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·é¾Ÿæ±¤äº’åŠ¨æˆ¿é—´</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- ä½¿ç”¨æœåŠ¡å™¨APIæ›¿ä»£P2Pè¿æ¥ -->
    <script src="js/api-client.js"></script>
    <style>
        .connection-status {
            margin-left: 15px;
            font-size: 0.9em;
        }
        
        .status-indicator {
            padding: 3px 6px;
            border-radius: 10px;
            font-weight: bold;
            background-color: #95a5a6;
            color: white;
        }
        
        .status-connected {
            background-color: #2ecc71;
        }
        
        .status-disconnected {
            background-color: #e74c3c;
        }
        
        .status-connecting {
            background-color: #f39c12;
        }
        
        .server-status {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            display: none;
        }
        
        .server-status.active {
            display: block;
        }
        
        .server-status-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .server-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .server-item {
            flex: 1;
            min-width: 120px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        
        .server-name {
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .server-indicator {
            font-size: 0.8em;
            padding: 2px 5px;
            border-radius: 3px;
            background-color: #95a5a6;
            color: white;
            text-align: center;
        }
        
        .server-connecting {
            background-color: #f39c12;
        }
        
        .server-connected {
            background-color: #2ecc71;
        }
        
        .server-failed {
            background-color: #e74c3c;
        }

        /* æœåŠ¡å™¨çŠ¶æ€æ ·å¼ */
        #server-status {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .server-status-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 3px;
        }
        .server-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        .server-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            background-color: #e9ecef;
        }
        .server-indicator.connecting {
            background-color: #ffc107;
            animation: blink 1s infinite;
        }
        .server-indicator.connected {
            background-color: #28a745;
        }
        .server-indicator.failed {
            background-color: #dc3545;
        }
        @keyframes blink {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        /* STUNæœåŠ¡å™¨çŠ¶æ€æ ·å¼ */
        .stun-status {
            margin-top: 10px;
            padding: 8px;
            background-color: #f1f8ff;
            border-radius: 4px;
            border-left: 3px solid #0366d6;
        }
        .stun-result {
            margin-top: 5px;
            color: #0366d6;
        }
        .connection-info {
            margin-top: 10px;
            padding: 8px;
            background-color: #f6f8fa;
            border-radius: 4px;
            border-left: 3px solid #2ea44f;
            color: #24292e;
        }
        .optimization-tip {
            margin-top: 10px;
            padding: 8px;
            background-color: #fff8c5;
            border-radius: 4px;
            border-left: 3px solid #b08800;
        }
        .optimization-tip div {
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="welcome-screen" class="screen active">
            <h1>æµ·é¾Ÿæ±¤äº’åŠ¨æˆ¿é—´</h1>
            <div class="role-selection">
                <button id="host-btn" class="btn">æˆ‘æ˜¯ä¸»æŒäºº</button>
                <button id="guest-btn" class="btn">æˆ‘æ˜¯å‚ä¸è€…</button>
            </div>
            <div id="server-status" class="server-status">
                <div class="server-status-title">æœåŠ¡å™¨è¿æ¥çŠ¶æ€:</div>
                <div class="server-list">
                    <div class="server-item" data-server="0">
                        <div class="server-name">0.peerjs.com</div>
                        <div class="server-indicator">å¾…æ£€æµ‹</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»æŒäººåˆ›å»ºæˆ¿é—´ç•Œé¢ -->
        <div id="host-setup-screen" class="screen">
            <h2>åˆ›å»ºæµ·é¾Ÿæ±¤æˆ¿é—´</h2>
            <div class="form-group">
                <label>æˆ¿é—´åç§°:</label>
                <input type="text" id="room-name" placeholder="ç»™æˆ¿é—´èµ·ä¸ªåå­—">
            </div>
            <div class="form-group">
                <label>ä¸»æŒäººæ˜µç§°:</label>
                <input type="text" id="host-name" placeholder="ä½ çš„æ˜µç§°">
            </div>
            <h3>æˆ¿é—´è§„åˆ™è®¾ç½®</h3>
            <div class="rules-setup">
                <div class="form-group">
                    <label for="soup-type">æ±¤çš„ç±»å‹:</label>
                    <select id="soup-type" aria-label="é€‰æ‹©æ±¤çš„ç±»å‹">
                        <option value="regular">æ™®é€šæ±¤</option>
                        <option value="red">çº¢æ±¤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="scoring-method">æ‰“åˆ†æ–¹å¼:</label>
                    <select id="scoring-method" aria-label="é€‰æ‹©æ‰“åˆ†æ–¹å¼">
                        <option value="host">ä»…ä¸»æŒäººæ‰“åˆ†</option>
                        <option value="all">æ‰€æœ‰äººæ‰“åˆ†</option>
                        <option value="none">ä¸æ‰“åˆ†</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="answer-method">å›ç­”æ–¹å¼:</label>
                    <select id="answer-method" aria-label="é€‰æ‹©å›ç­”æ–¹å¼">
                        <option value="free">è‡ªç”±å›ç­”</option>
                        <option value="raise-hand">ä¸¾æ‰‹å›ç­”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="interaction-method">äº’åŠ¨æ–¹å¼:</label>
                    <select id="interaction-method" aria-label="é€‰æ‹©äº’åŠ¨æ–¹å¼">
                        <option value="enabled">å…è®¸ä¸¢é²œèŠ±å’Œåƒåœ¾</option>
                        <option value="disabled">ä¸å…è®¸ä¸¢é²œèŠ±å’Œåƒåœ¾</option>
                    </select>
                </div>
            </div>
            <button id="create-room-btn" class="btn">åˆ›å»ºæˆ¿é—´</button>
            <button id="back-from-host" class="btn-back">è¿”å›</button>
        </div>

        <!-- å‚ä¸è€…åŠ å…¥æˆ¿é—´ç•Œé¢ -->
        <div id="guest-setup-screen" class="screen">
            <h2>åŠ å…¥æµ·é¾Ÿæ±¤æˆ¿é—´</h2>
            <div class="form-group">
                <label for="room-id">æˆ¿é—´ID:</label>
                <input type="text" id="room-id" placeholder="è¾“å…¥4-10ä½å¤§å†™å­—æ¯å’Œæ•°å­—" maxlength="10" style="text-transform: uppercase;">
                <small class="form-hint">æˆ¿é—´IDä¸º4-10ä½å¤§å†™å­—æ¯å’Œæ•°å­—</small>
            </div>
            <div class="form-group">
                <label>ä½ çš„æ˜µç§°:</label>
                <input type="text" id="guest-name" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
            </div>
            <button id="join-room-btn" class="btn">åŠ å…¥æˆ¿é—´</button>
            <button id="back-from-guest" class="btn-back">è¿”å›</button>
        </div>

        <!-- å‚ä¸è€…ç­‰å¾…ç¡®è®¤ç•Œé¢ -->
        <div id="guest-waiting-screen" class="screen">
            <h2>ç­‰å¾…ä¸»æŒäººç¡®è®¤</h2>
            <div class="waiting-container">
                <div id="guest-waiting-message" class="waiting-message">æ­£åœ¨åŠ å…¥æˆ¿é—´...</div>
                <div class="spinner"></div>
                <div class="waiting-info">ä¸»æŒäººéœ€è¦ç¡®è®¤æ‚¨çš„åŠ å…¥è¯·æ±‚ï¼Œè¯·ç¨å€™...</div>
                <button id="cancel-join-btn" class="btn">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- ä¸»æŒäººæˆ¿é—´ç•Œé¢ -->
        <div id="host-room-screen" class="screen">
            <div class="room-header">
                <h2 id="host-room-name">æˆ¿é—´: </h2>
                <div class="room-id-display">
                    <div class="room-id-label">æˆ¿é—´ID:</div>
                    <div class="room-id-value" id="room-id-display"></div>
                    <button id="copy-room-id" class="btn-small">å¤åˆ¶</button>
                    <span id="host-connection-status" class="connection-status">è¿æ¥çŠ¶æ€: <span class="status-indicator">åˆå§‹åŒ–ä¸­</span></span>
                </div>
            </div>
            <div class="room-content">
                <div class="sidebar">
                    <div class="participants-list">
                        <h3>å‚ä¸è€…åˆ—è¡¨</h3>
                        <ul id="participants-list"></ul>
                    </div>
                    <div class="rules-display">
                        <h3>æˆ¿é—´è§„åˆ™</h3>
                        <ul id="rules-list"></ul>
                    </div>
                </div>
                <div class="main-area">
                    <div class="puzzle-section">
                        <h3>è°œé¢˜è®¾ç½®</h3>
                        <textarea id="puzzle-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥æµ·é¾Ÿæ±¤è°œé¢˜..."></textarea>
                        <button id="publish-puzzle-btn" class="btn">å‘å¸ƒè°œé¢˜</button>
                    </div>
                    <div class="intel-section">
                        <h3>å‘å¸ƒæƒ…æŠ¥</h3>
                        <textarea id="intel-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥é¢å¤–æƒ…æŠ¥..."></textarea>
                        <button id="publish-intel-btn" class="btn">å‘å¸ƒæƒ…æŠ¥</button>
                    </div>
                    <div class="chat-section">
                        <div class="chat-messages" id="host-chat-messages">
                            <!-- èŠå¤©æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                        </div>
                        <div class="host-response-buttons">
                            <button id="yes-btn" class="response-btn">æ˜¯</button>
                            <button id="no-btn" class="response-btn">å¦</button>
                            <button id="uncertain-btn" class="response-btn">ä¸ç¡®å®š</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="room-controls">
                <button id="end-game-btn" class="btn">ç»“æŸæ¸¸æˆ</button>
                <button id="continue-game-btn" class="btn">ç»§ç»­æ¸¸æˆ</button>
                <button id="leave-room-btn" class="btn-danger">ç¦»å¼€æˆ¿é—´</button>
            </div>
        </div>

        <!-- å‚ä¸è€…æˆ¿é—´ç•Œé¢ -->
        <div id="guest-room-screen" class="screen">
            <div class="room-header">
                <h2 id="guest-room-name">æˆ¿é—´: </h2>
                <div class="host-info">
                    ä¸»æŒäºº: <span id="host-info-display"></span>
                    <span id="guest-connection-status" class="connection-status">è¿æ¥çŠ¶æ€: <span class="status-indicator">åˆå§‹åŒ–ä¸­</span></span>
                </div>
            </div>
            <div class="room-content">
                <div class="sidebar">
                    <div class="participants-list">
                        <h3>å‚ä¸è€…åˆ—è¡¨</h3>
                        <ul id="guest-participants-list"></ul>
                    </div>
                    <div class="rules-display">
                        <h3>æˆ¿é—´è§„åˆ™</h3>
                        <ul id="guest-rules-list"></ul>
                    </div>
                    <div class="notes-section">
                        <h3>ä¸ªäººç¬”è®°</h3>
                        <textarea id="personal-notes" placeholder="åœ¨è¿™é‡Œè®°å½•ç¬”è®°..."></textarea>
                    </div>
                </div>
                <div class="main-area">
                    <div class="puzzle-display">
                        <h3>è°œé¢˜</h3>
                        <div id="puzzle-display" class="content-box"></div>
                    </div>
                    <div class="intel-display">
                        <h3>ä¸»æŒäººæƒ…æŠ¥</h3>
                        <div id="intel-display" class="content-box"></div>
                    </div>
                    <div class="chat-section">
                        <div class="chat-messages" id="guest-chat-messages">
                            <!-- èŠå¤©æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                        </div>
                        <div class="chat-input">
                            <input type="text" id="question-input" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                            <button id="send-question-btn" class="btn">å‘é€</button>
                            <button id="raise-hand-btn" class="btn" style="display: none;">ä¸¾æ‰‹</button>
                        </div>
                        <div class="reaction-buttons" id="reaction-buttons">
                            <button id="flower-btn" class="reaction-btn">ğŸŒ¹</button>
                            <button id="trash-btn" class="reaction-btn">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="room-controls">
                <button id="guest-leave-room-btn" class="btn-danger">ç¦»å¼€æˆ¿é—´</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥è‡ªå®šä¹‰JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/ui-utils.js"></script>
    <script src="js/connection.js"></script>
    <script src="js/message-handler.js"></script>
    <script src="js/host-functions.js"></script>
    <script src="js/guest-functions.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 